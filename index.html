<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gesti√≥n para Profesores</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
  
  <style>
    /* Estilo simple para mejorar la fuente por defecto */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
  </style>
</head>
<body>
  
  <div id="root"></div>

  <script type="text/babel">
    // --- INICIO DEL C√ìDIGO DE LA APLICACI√ìN ---

    // El c√≥digo completo que proporcionaste va aqu√≠.
    // Lo he copiado y pegado a continuaci√≥n.

    const { useEffect, useMemo, useState } = React;

    /**
     * Gesti√≥n de P√°del ‚Äì MVP en React (Canvas) - v16 con Dashboard y Funciones Avanzadas
     *
     * Cambios aplicados:
     * - Se a√±ade un "Dashboard" como pantalla principal con res√∫menes diarios y semanales.
     * - Se implementa la creaci√≥n de "Clases Recurrentes" para automatizar la agenda.
     * - Se a√±ade gesti√≥n de "Canchas/Ubicaciones" desde el Perfil, asignables a cada clase.
     * - Se crea una nueva vista de "Control de Deudas" en la secci√≥n de Pagos.
     * - La aplicaci√≥n ahora es una herramienta de gesti√≥n integral.
     */

    // ------------------------------ Constantes y Utilidades ------------------------------
    const uid = () => Math.random().toString(36).slice(2) + Date.now().toString(36);
    const toDigits = (s = "") => String(s).replace(/[^0-9]/g, "");
    const waLink = (telefono = "", nombre = "") => {
      const digits = toDigits(telefono);
      if (!digits) return null;
      const msg = encodeURIComponent(`Hola ${nombre || ""}!`);
      return `https://wa.me/${digits}?text=${msg}`;
    };
    // --- Utilidades de Fecha ---
    const getWeekStartDate = (date) => {
      const d = new Date(date);
      const day = d.getDay();
      const diff = d.getDate() - day + (day === 0 ? -6 : 1);
      d.setHours(0, 0, 0, 0);
      return new Date(d.setDate(diff));
    };
    const addDays = (date, days) => {
      const result = new Date(date);
      result.setDate(result.getDate() + days);
      return result;
    };
    const formatDate = (date, format = 'yyyy-mm-dd') => {
      if (!date) return '';
      const d = new Date(date);
      const year = d.getFullYear();
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      if (format === 'dd/mm') return `${day}/${month}`;
      return `${year}-${month}-${day}`;
    };
    // --- Fin Utilidades de Fecha ---

    const LS_KEY = "gpadel_state_v16";
    const initialState = { 
      alumnos: [], 
      clases: [], 
      pagos: [], 
      gastos: [],
      perfil: {
        nombre: "Profe",
        apellido: "P√°del",
        telefono: "",
        precios: { individual: "5000", dupla: "4000", trio: "3500", cuarteto: "3000", escuelita: "2500" },
        preciosMensuales: { "1xSemana": "18000", "2xSemana": "32000", "3xSemana": "45000", libre: "55000" },
        metodoCobro: "porClase",
        canchas: "Club A - Cancha 1\nClub B - Cancha 2"
      }
    };
    // Constantes para formularios
    const DIAS_SEMANA_NOMBRES = ["Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes", "S√°bado", "Domingo"];
    const MESES_NOMBRES = ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"];
    const DEPORTES = ["P√°del", "Tenis"];
    const ESTADOS_ALUMNO = [{value: "activo", label: "Activo"}, {value: "espera", label: "Lista de espera"}];
    const ESTADOS_CLASE = ["Programada", "Realizada", "Cancelada", "Ausente"];
    const TIPOS_CLASE_MAP = { Individual: 1, Dupla: 2, Trio: 3, Cuarteto: 4, Escuelita: 1 };
    const TIPOS_CLASE = Object.keys(TIPOS_CLASE_MAP);
    const METODOS_PAGO = ["Efectivo", "Transferencia", "Pendiente"];
    const CATEGORIAS_GASTO = ["Alquiler", "Equipamiento", "Servicios", "Varios"];
    const PLANES_PAGO = [{value: "porClase", label: "Por Clase"}, {value: "mensual", label: "Mensual"}];
    const FRECUENCIAS_MENSUALES = [{value: "1xSemana", label: "1 vez por semana"}, {value: "2xSemana", label: "2 veces por semana"}, {value: "3xSemana", label: "3 veces por semana"}, {value: "libre", label: "Libre"}];
    
    function useLocalState() {
      const [state, setState] = useState(() => {
        try { const raw = localStorage.getItem(LS_KEY); return raw ? JSON.parse(raw) : initialState; } catch { return initialState; }
      });
      useEffect(() => { try { localStorage.setItem(LS_KEY, JSON.stringify(state)); } catch {} }, [state]);
      return [state, setState];
    }

    // ------------------------------ UI B√°sicos ------------------------------
    function Card({ title, right, children }) { return (<section className="bg-white rounded-2xl shadow-sm border border-slate-200 p-4"><div className="flex items-center justify-between mb-3"><h3 className="text-base font-semibold text-slate-800">{title}</h3>{right}</div>{children}</section>); }
    function Toast({ msg, onClose }) { useEffect(() => { if (!msg) return; const t = setTimeout(onClose, 1800); return () => clearTimeout(t); }, [msg, onClose]); if (!msg) return null; return (<div className="fixed top-4 right-4 bg-emerald-600 text-white px-4 py-2 rounded-xl shadow-xl z-50">{msg}</div>); }
    function Modal({ isOpen, title, children, onConfirm, onCancel, confirmText = "Confirmar" }) { if (!isOpen) return null; return (<div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"><div className="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md"><h3 className="text-lg font-semibold mb-4">{title}</h3><div className="text-slate-600 mb-6">{children}</div><div className="flex justify-end gap-3"><button onClick={onCancel} className="px-4 py-2 rounded-lg border">Cancelar</button><button onClick={onConfirm} className={`px-4 py-2 rounded-lg text-white ${confirmText === "Confirmar" ? "bg-red-600" : "bg-emerald-600"}`}>{confirmText}</button></div></div></div>); }
    function Topbar({ current, setCurrent }) { const tabs = [ { id: "dashboard", label: "Dashboard" }, { id: "alumnos", label: "Alumnos" }, { id: "clases", label: "Clases" }, { id: "pagos", label: "Pagos" }, { id: "gastos", label: "Gastos" }, { id: "reportes", label: "Reportes" }, { id: "perfil", label: "Perfil" } ]; return (<header className="w-full bg-slate-900 text-white"><div className="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between"><div className="flex items-center gap-3"><div className="w-9 h-9 rounded-2xl bg-emerald-500 grid place-items-center font-bold">GP</div><div><h1 className="text-lg leading-tight font-semibold">Gesti√≥n de P√°del</h1><p className="text-xs opacity-80 -mt-0.5">MVP ¬∑ Demo local</p></div></div><nav className="hidden md:flex items-center gap-2">{tabs.map((t) => (<button key={t.id} onClick={() => setCurrent(t.id)} className={`px-3 py-1.5 rounded-xl text-sm transition ${current === t.id ? "bg-white text-slate-900" : "hover:bg-slate-800"}`}>{t.label}</button>))}</nav></div><div className="md:hidden px-3 pb-3 grid grid-cols-3 sm:grid-cols-5 gap-2">{tabs.map((t) => (<button key={t.id} onClick={() => setCurrent(t.id)} className={`px-3 py-2 rounded-xl text-sm transition ${current === t.id ? "bg-white text-slate-900" : "bg-slate-800 text-white"}`}>{t.label}</button>))}</div></header>); }

    // ------------------------------ DASHBOARD (NUEVO) ------------------------------
    function Dashboard({ state }) {
        const { clases, pagos, gastos, alumnos, perfil } = state;
        const alumnoMap = useMemo(() => new Map(alumnos.map(a => [a.id, a.nombre])), [alumnos]);

        const hoy = formatDate(new Date());
        const semanaInicio = formatDate(getWeekStartDate(new Date()));

        const clasesHoy = useMemo(() => {
            return clases
                .filter(c => c.fecha === hoy)
                .map(c => ({...c, nombresAlumnos: (c.alumnoIds || []).map(id => alumnoMap.get(id)).filter(Boolean).join(', ')}))
                .sort((a, b) => a.hora.localeCompare(b.hora));
        }, [clases, hoy, alumnoMap]);
        
        const balanceSemana = useMemo(() => {
            const ingresos = pagos
                .filter(p => p.fecha >= semanaInicio && p.metodo !== 'Pendiente')
                .reduce((acc, p) => acc + parseFloat(p.monto), 0);
            const egresos = gastos
                .filter(g => g.fecha >= semanaInicio)
                .reduce((acc, g) => acc + parseFloat(g.monto), 0);
            return ingresos - egresos;
        }, [pagos, gastos, semanaInicio]);
        
        const pagosPendientes = useMemo(() => {
            let pendientes = 0;
            const alumnosMensuales = alumnos.filter(a => a.plan === 'mensual' && a.estado === 'activo');
            const pagosMensualesMesActual = pagos.filter(p => p.concepto?.startsWith("Cuota Mensual") && new Date(p.fecha).getMonth() === new Date().getMonth());

            alumnosMensuales.forEach(alumno => {
                const cuota = parseFloat(perfil.preciosMensuales[alumno.frecuencia] || 0);
                const totalPagado = pagosMensualesMesActual.filter(p => p.alumnoId === alumno.id).reduce((acc, p) => acc + parseFloat(p.monto), 0);
                if (cuota > totalPagado) {
                    pendientes++;
                }
            });
            return pendientes;
        }, [pagos, alumnos, perfil]);
        
        return (
            <div className="grid gap-4">
                <div className="grid md:grid-cols-3 gap-4">
                    <div className="bg-blue-50 p-4 rounded-xl"><p className="text-sm text-blue-800">Clases de Hoy</p><p className="text-2xl font-bold text-blue-900">{clasesHoy.length}</p></div>
                    <div className="bg-orange-50 p-4 rounded-xl"><p className="text-sm text-orange-800">Pagos Mensuales Pendientes</p><p className="text-2xl font-bold text-orange-900">{pagosPendientes}</p></div>
                    <div className="bg-emerald-50 p-4 rounded-xl"><p className="text-sm text-emerald-800">Balance de la Semana</p><p className={`text-2xl font-bold ${balanceSemana >= 0 ? 'text-emerald-900' : 'text-red-900'}`}>${balanceSemana.toFixed(2)}</p></div>
                </div>
                <Card title="Agenda del D√≠a">
                    {clasesHoy.length === 0 ? (
                        <p className="text-sm text-slate-500">No hay clases programadas para hoy.</p>
                    ) : (
                        <ul className="space-y-2">
                            {clasesHoy.map(c => (
                                <li key={c.id} className="p-2 border-b flex justify-between items-center">
                                    <div>
                                        <p className="font-semibold">{c.hora} - {c.nombresAlumnos}</p>
                                        <p className="text-xs text-slate-500">{c.tipo} en {c.cancha || 'N/A'}</p>
                                    </div>
                                    <span className={`px-2 py-0.5 rounded-full text-xs ${c.estado === 'Programada' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'}`}>{c.estado}</span>
                                </li>
                            ))}
                        </ul>
                    )}
                </Card>
            </div>
        );
    }


    // ------------------------------ FORMULARIO ALUMNO ------------------------------
    function AlumnoForm({ initialData, onSubmit, onCancel }) {
      const [form, setForm] = useState(initialData);
      const handleChange = (e) => { const { name, value } = e.target; setForm(prev => ({ ...prev, [name]: value })); };
      const addHorario = () => setForm(f => ({ ...f, horarios: [...f.horarios, { dia: "Lunes", hora: "18:00" }] }));
      const delHorario = (idx) => setForm(f => ({ ...f, horarios: f.horarios.filter((_, i) => i !== idx) }));
      const setHorario = (idx, key, val) => setForm(f => ({ ...f, horarios: f.horarios.map((h, i) => i === idx ? { ...h, [key]: val } : h) }));
      function handleSubmit(e) { e.preventDefault(); if (!form.nombre.trim()) return alert("Ingres√° un nombre"); onSubmit(form); }
      return (
        <form onSubmit={handleSubmit} className="grid md:grid-cols-6 gap-3">
          <div className="md:col-span-2"><label className="text-sm text-slate-600">Nombre</label><input name="nombre" value={form.nombre} onChange={handleChange} className="w-full border rounded-lg px-3 py-2" placeholder="Ej: Sof√≠a P√©rez" required /></div>
          <div className="md:col-span-2"><label className="text-sm text-slate-600">Tel√©fono</label><input name="telefono" value={form.telefono} onChange={handleChange} className="w-full border rounded-lg px-3 py-2" placeholder="Ej: 549381..." /></div>
          <div><label className="text-sm text-slate-600">Deporte</label><select name="deporte" value={form.deporte} onChange={handleChange} className="w-full border rounded-lg px-3 py-2">{DEPORTES.map(d => <option key={d}>{d}</option>)}</select></div>
          <div><label className="text-sm text-slate-600">Estado</label><select name="estado" value={form.estado} onChange={handleChange} className="w-full border rounded-lg px-3 py-2">{ESTADOS_ALUMNO.map(e => <option key={e.value} value={e.value}>{e.label}</option>)}</select></div>
          <div className="md:col-span-3"><label className="text-sm text-slate-600">Plan de Pago</label><select name="plan" value={form.plan} onChange={handleChange} className="w-full border rounded-lg px-3 py-2">{PLANES_PAGO.map(p => <option key={p.value} value={p.value}>{p.label}</option>)}</select></div>
          {form.plan === 'mensual' && (<div className="md:col-span-3"><label className="text-sm text-slate-600">Frecuencia</label><select name="frecuencia" value={form.frecuencia} onChange={handleChange} className="w-full border rounded-lg px-3 py-2">{FRECUENCIAS_MENSUALES.map(f => <option key={f.value} value={f.value}>{f.label}</option>)}</select></div>)}
          <div className="md:col-span-6"><label className="text-sm text-slate-600">Horarios fijos</label><div className="grid gap-2">{form.horarios.map((h, idx) => (<div key={idx} className="flex gap-2 items-center flex-wrap"><select value={h.dia} onChange={(e) => setHorario(idx, 'dia', e.target.value)} className="border rounded-lg px-3 py-2">{DIAS_SEMANA_NOMBRES.map(d => <option key={d}>{d}</option>)}</select><input type="time" value={h.hora} onChange={(e) => setHorario(idx, 'hora', e.target.value)} className="border rounded-lg px-3 py-2" /><button type="button" onClick={() => delHorario(idx)} className="px-2 py-2 rounded-lg border text-red-600 hover:bg-red-50">‚àí</button></div>))}<button type="button" onClick={addHorario} className="self-start px-3 py-1.5 rounded-lg border w-auto">+ Agregar horario</button></div></div>
          <div className="md:col-span-6"><label className="text-sm text-slate-600">Notas / Descripci√≥n</label><textarea name="notas" value={form.notas} onChange={handleChange} className="w-full border rounded-lg px-3 py-2" rows={3} placeholder="Detalle particular del alumno" /></div>
          <div className="md:col-span-6 flex gap-2 justify-end"><button type="button" onClick={onCancel} className="px-3 py-2 rounded-lg border">Cancelar</button><button type="submit" className="px-3 py-2 rounded-lg bg-emerald-600 text-white">Guardar</button></div>
        </form>
      );
    }

    // ------------------------------ ALUMNOS ------------------------------
    function Alumnos({ alumnos, onCreate, onUpdate, onDelete }) {
      const [q, setQ] = useState("");
      const [showForm, setShowForm] = useState(false);
      const [editing, setEditing] = useState(null);
      const emptyForm = { nombre: "", telefono: "", deporte: "P√°del", estado: "activo", plan: "porClase", frecuencia: "1xSemana", notas: "", horarios: [] };
      const filtered = useMemo(() => { const s = q.trim().toLowerCase(); if (!s) return alumnos; return alumnos.filter((a) => [a.nombre, a.telefono, a.deporte, a.estado].some((x) => (x || "").toLowerCase().includes(s))); }, [alumnos, q]);
      function openNew() { setEditing(null); setShowForm(true); window.scrollTo({ top: 0, behavior: "smooth" }); }
      function openEdit(a) { setEditing(a); setShowForm(true); window.scrollTo({ top: 0, behavior: "smooth" }); }
      function cancel() { setShowForm(false); setEditing(null); }
      function submit(formData) { if (editing) { onUpdate({ ...editing, ...formData }); } else { onCreate({ id: uid(), ...formData }); } cancel(); }
      return (
        <div className="grid gap-4">
          <Card title={editing ? "Editar alumno" : "Nuevo alumno"} right={!showForm && <button onClick={openNew} className="bg-slate-900 text-white text-sm px-3 py-1.5 rounded-xl">+ Nuevo</button>}>
            {showForm ? (<AlumnoForm initialData={editing ? { ...emptyForm, ...editing } : emptyForm} onSubmit={submit} onCancel={cancel} />) : (<p className="text-sm text-slate-500">Hac√© clic en <b>+ Nuevo</b> para crear un alumno, o en el l√°piz para editar.</p>)}
          </Card>
          <Card title="Listado de alumnos" right={<input value={q} onChange={(e) => setQ(e.target.value)} placeholder="Buscar" className="border rounded-xl px-3 py-1.5 text-sm" />}>
            <div className="overflow-x-auto"><table className="min-w-full text-sm"><thead><tr className="text-left text-slate-600"><th className="p-2">Nombre</th><th className="p-2">Tel√©fono</th><th className="p-2">Plan de Pago</th><th className="p-2">Estado</th><th className="p-2 text-right">Acciones</th></tr></thead><tbody>{filtered.length === 0 && (<tr><td colSpan={5} className="text-center py-6 text-slate-400">No hay alumnos</td></tr>)}{filtered.map((a) => (<tr key={a.id} className="border-t"><td className="p-2">{a.nombre}</td><td className="p-2"><div className="flex items-center gap-2"><span>{a.telefono || "-"}</span>{a.telefono && (<a href={waLink(a.telefono, a.nombre)} target="_blank" rel="noreferrer" className="inline-flex items-center px-2 py-0.5 text-xs rounded-full border text-green-700 bg-green-50 hover:bg-green-100">WhatsApp</a>)}</div></td><td className="p-2">{a.plan === 'mensual' ? 'Mensual' : 'Por Clase'}</td><td className="p-2"><span className={`px-2 py-0.5 rounded-full text-xs ${a.estado === 'espera' ? 'bg-amber-100 text-amber-800' : 'bg-emerald-100 text-emerald-800'}`}>{a.estado === 'espera' ? 'Espera' : 'Activo'}</span></td><td className="p-2 text-right"><div className="inline-flex gap-2"><button onClick={() => openEdit(a)} className="px-2 py-1 text-xs rounded-lg border hover:bg-slate-50">‚úèÔ∏è Editar</button><button type="button" onClick={() => onDelete(a.id)} className="px-2 py-1 text-xs rounded-lg border text-red-600 hover:bg-red-50">üóëÔ∏è Eliminar</button></div></td></tr>))}</tbody></table></div>
          </Card>
        </div>
      );
    }

    // ------------------------------ CALENDARIO SEMANAL ------------------------------
    const HORAS = Array.from({ length: 15 }, (_, i) => `${String(i + 8).padStart(2, '0')}:00`);
    function CalendarioSemanal({ week, clases, onEdit }) {
      const getStatusColor = (status) => {
        switch (status) { case "Realizada": return "bg-green-200 border-green-400"; case "Cancelada": return "bg-red-200 border-red-400"; case "Ausente": return "bg-yellow-200 border-yellow-400"; default: return "bg-blue-200 border-blue-400"; }
      };
      const clasesPorDiaHora = useMemo(() => { const map = {}; clases.forEach(clase => { const key = `${clase.fecha}_${clase.hora}`; if (!map[key]) map[key] = []; map[key].push(clase); }); return map; }, [clases]);
      return (
        <div className="grid grid-cols-[auto_repeat(7,1fr)] gap-px bg-slate-200 border border-slate-200">
          <div className="bg-white p-2"></div>
          {week.map(day => (<div key={day} className="bg-white p-2 text-center font-semibold text-sm"><div>{DIAS_SEMANA_NOMBRES[new Date(day).getDay() === 0 ? 6 : new Date(day).getDay() - 1]}</div><div className="text-xs text-slate-500">{formatDate(new Date(day), 'dd/mm')}</div></div>))}
          {HORAS.map(hora => (<React.Fragment key={hora}><div className="bg-white text-center text-xs p-2">{hora}</div>{week.map(day => (<div key={`${day}-${hora}`} className="bg-slate-50 min-h-[60px] p-1">{(clasesPorDiaHora[`${day}_${hora}`] || []).map(clase => (<div key={clase.id} onClick={() => onEdit(clase)} className={`text-xs p-1 rounded border cursor-pointer mb-1 ${getStatusColor(clase.estado)}`}>{clase.nombresAlumnos}<div className="text-[10px] opacity-70">{clase.cancha}</div></div>))}</div>))}</React.Fragment>))}
        </div>
      );
    }

    // ------------------------------ CLASES ------------------------------
    function Clases({ clases, alumnos, pagos, perfil, onCreate, onUpdate, onDelete, onPay }) {
      const [showForm, setShowForm] = useState(false);
      const [editing, setEditing] = useState(null);
      const emptyForm = { alumnoIds: [""], fecha: formatDate(new Date()), hora: "18:00", tipo: "Individual", estado: "Programada", precio: perfil.precios.individual, notas: "", cancha: "", recurrente: false };
      const [form, setForm] = useState(emptyForm);
      const [currentDate, setCurrentDate] = useState(new Date());

      const weekStartDate = getWeekStartDate(currentDate);
      const weekDates = Array.from({ length: 7 }, (_, i) => formatDate(addDays(weekStartDate, i)));
      const alumnosActivos = useMemo(() => alumnos.filter(a => a.estado === 'activo'), [alumnos]);
      const alumnoMap = useMemo(() => new Map(alumnos.map(a => [a.id, a])), [alumnos]);
      const pagosPorClase = useMemo(() => { const map = new Map(); pagos.forEach(p => map.set(p.claseId, p)); return map; }, [pagos]);
      const clasesConDatos = useMemo(() => clases.map(c => ({ ...c, nombresAlumnos: (c.alumnoIds || []).map(id => alumnoMap.get(id)?.nombre).filter(Boolean).join(', '), pago: pagosPorClase.get(c.id) })), [clases, alumnoMap, pagosPorClase]);
      const clasesDeLaSemana = useMemo(() => clasesConDatos.filter(c => weekDates.includes(c.fecha)), [clasesConDatos, weekDates]);
      const canchasDisponibles = useMemo(() => perfil.canchas.split('\n').filter(c => c.trim() !== ''), [perfil.canchas]);
      function handleFormChange(e) {
        const { name, value, type, checked } = e.target;
        const val = type === 'checkbox' ? checked : value;
        setForm(prev => {
          const newState = { ...prev, [name]: val };
          if (name === "tipo") {
            newState.precio = perfil.precios[val.toLowerCase()] || "";
            const numAlumnos = TIPOS_CLASE_MAP[val] || 1;
            newState.alumnoIds = Array.from({ length: numAlumnos }, (_, i) => prev.alumnoIds[i] || "");
          }
          return newState;
        });
      }
      
      function handleAlumnoChange(index, newId) {
        setForm(prev => {
          const newAlumnoIds = prev.alumnoIds.map((id, i) => i === index ? newId : id);
          const primerAlumno = alumnoMap.get(newAlumnoIds[0]);
          const esPlanMensual = primerAlumno?.plan === 'mensual';
          return {
            ...prev,
            alumnoIds: newAlumnoIds,
            precio: esPlanMensual ? "0" : prev.precio
          };
        });
      }

      function openNew() { setEditing(null); setForm({ ...emptyForm, alumnoIds: [alumnosActivos[0]?.id || ""], precio: perfil.precios.individual, cancha: canchasDisponibles[0] || "" }); setShowForm(true); window.scrollTo({ top: 0, behavior: "smooth" }); }
      function openEdit(c) { setEditing(c); setForm({ ...emptyForm, ...c, recurrente: false }); setShowForm(true); window.scrollTo({ top: 0, behavior: "smooth" }); }
      function cancel() { setShowForm(false); setEditing(null); setForm(emptyForm); }
      function submit(e) { e.preventDefault(); const validAlumnos = form.alumnoIds.filter(id => id); if (validAlumnos.length === 0) return alert("Seleccion√° al menos un alumno"); const finalForm = {...form, alumnoIds: validAlumnos}; if (editing) { onUpdate({ ...editing, ...finalForm }); } else { onCreate(finalForm); } cancel(); }
      const changeWeek = (offset) => setCurrentDate(prev => addDays(prev, offset * 7));
      function handleStatusChange(clase, newStatus) {
        const updatedClase = { ...clase, estado: newStatus };
        onUpdate(updatedClase);
        const primerAlumno = alumnoMap.get(clase.alumnoIds[0]);
        if (newStatus === 'Realizada' && !clase.pago && primerAlumno?.plan !== 'mensual') {
          onPay(clase);
        }
      }
      
      const primerAlumnoId = form.alumnoIds[0];
      const esMensual = alumnoMap.get(primerAlumnoId)?.plan === 'mensual';
      return (
        <div className="grid gap-4">
          <Card title={editing ? "Editar clase" : "Nueva clase"} right={!showForm && <button onClick={openNew} className="bg-slate-900 text-white text-sm px-3 py-1.5 rounded-xl">+ Nueva</button>}>
            {showForm ? (
              <form onSubmit={submit} className="grid md:grid-cols-6 gap-3">
                <div className="md:col-span-6 grid grid-cols-1 md:grid-cols-2 gap-3">
                  {(form.alumnoIds || [""]).map((alumnoId, index) => (
                    <div key={index}>
                      <label className="text-sm text-slate-600">Alumno {index + 1}</label>
                      <select value={alumnoId} onChange={(e) => handleAlumnoChange(index, e.target.value)} className="w-full border rounded-lg px-3 py-2" required>
                        <option value="">Seleccionar...</option>
                        {alumnosActivos.filter(a => !form.alumnoIds.includes(a.id) || a.id === alumnoId).map(a => <option key={a.id} value={a.id}>{a.nombre}</option>)}
                      </select>
                    </div>
                  ))}
                </div>
                <div className="md:col-span-2"><label className="text-sm text-slate-600">Ubicaci√≥n / Cancha</label><select name="cancha" value={form.cancha} onChange={handleFormChange} className="w-full border rounded-lg px-3 py-2">{canchasDisponibles.map(c => <option key={c}>{c}</option>)}</select></div>
                <div><label className="text-sm text-slate-600">Fecha</label><input type="date" name="fecha" value={form.fecha} onChange={handleFormChange} className="w-full border rounded-lg px-3 py-2" required /></div>
                <div><label className="text-sm text-slate-600">Hora</label><input type="time" name="hora" value={form.hora} onChange={handleFormChange} className="w-full border rounded-lg px-3 py-2" required /></div>
                <div><label className="text-sm text-slate-600">Tipo de Clase</label><select name="tipo" value={form.tipo} onChange={handleFormChange} className="w-full border rounded-lg px-3 py-2">{TIPOS_CLASE.map(t => <option key={t}>{t}</option>)}</select></div>
                <div><label className="text-sm text-slate-600">Precio</label><input type="number" name="precio" value={esMensual ? "Plan Mensual" : form.precio} onChange={handleFormChange} className={`w-full border rounded-lg px-3 py-2 ${esMensual ? 'bg-slate-100' : ''}`} placeholder="0" disabled={esMensual} /></div>
                <div className="md:col-span-2"><label className="text-sm text-slate-600">Estado</label><select name="estado" value={form.estado} onChange={handleFormChange} className="w-full border rounded-lg px-3 py-2">{ESTADOS_CLASE.map(e => <option key={e}>{e}</option>)}</select></div>
                <div className="md:col-span-6"><label className="text-sm text-slate-600">Notas</label><textarea name="notas" value={form.notas} onChange={handleFormChange} className="w-full border rounded-lg px-3 py-2" rows={2} placeholder="Comentarios sobre la clase" /></div>
                {!editing && <div className="md:col-span-6 flex items-center gap-2"><input type="checkbox" name="recurrente" id="recurrente" checked={form.recurrente} onChange={handleFormChange} /><label htmlFor="recurrente" className="text-sm text-slate-600">Repetir semanalmente por 3 meses</label></div>}
                <div className="md:col-span-6 flex gap-2 justify-end"><button type="button" onClick={cancel} className="px-3 py-2 rounded-lg border">Cancelar</button><button className="px-3 py-2 rounded-lg bg-emerald-600 text-white">Guardar</button></div>
              </form>
            ) : ( <p className="text-sm text-slate-500">Hac√© clic en <b>+ Nueva</b> para programar una clase.</p> )}
          </Card>
          <Card title="Calendario Semanal" right={<div className="flex items-center gap-2"><button onClick={() => changeWeek(-1)} className="px-3 py-1.5 text-sm rounded-lg border">‚Äπ Ant</button><button onClick={() => setCurrentDate(new Date())} className="px-3 py-1.5 text-sm rounded-lg border">Hoy</button><button onClick={() => changeWeek(1)} className="px-3 py-1.5 text-sm rounded-lg border">Sig ‚Ä∫</button></div>}><CalendarioSemanal week={weekDates} clases={clasesDeLaSemana} onEdit={openEdit} /></Card>
          <Card title="Listado de clases">
            <div className="overflow-x-auto"><table className="min-w-full text-sm"><thead><tr className="text-left text-slate-600"><th className="p-2">Fecha</th><th className="p-2">Alumnos</th><th className="p-2">Ubicaci√≥n</th><th className="p-2">Estado</th><th className="p-2">Precio</th><th className="p-2 text-right">Acciones</th></tr></thead><tbody>{clasesConDatos.sort((a, b) => new Date(b.fecha) - new Date(a.fecha)).length === 0 && (<tr><td colSpan={6} className="text-center py-6 text-slate-400">No hay clases programadas</td></tr>)}{clasesConDatos.map((c) => (<tr key={c.id} className="border-t"><td className="p-2">{c.fecha} {c.hora}</td><td className="p-2">{c.nombresAlumnos}</td><td className="p-2">{c.cancha}</td><td className="p-2"><select value={c.estado} onChange={(e) => handleStatusChange(c, e.target.value)} className="w-full border rounded-lg px-2 py-1 bg-white"><option disabled>{c.estado}</option>{ESTADOS_CLASE.map(e => <option key={e}>{e}</option>)}</select></td><td className="p-2 flex items-center gap-2">{c.precio ? `$${c.precio}` : '-'}{c.pago && <span className={`w-2 h-2 rounded-full ${c.pago.metodo === 'Pendiente' ? 'bg-orange-400' : 'bg-green-500'}`} title={`Pago: ${c.pago.metodo}`}></span>}</td><td className="p-2 text-right"><div className="inline-flex gap-2"><button onClick={() => openEdit(c)} className="px-2 py-1 text-xs rounded-lg border hover:bg-slate-50">‚úèÔ∏è Editar</button><button type="button" onClick={() => onDelete(c.id)} className="px-2 py-1 text-xs rounded-lg border text-red-600 hover:bg-red-50">üóëÔ∏è Eliminar</button></div></td></tr>))}</tbody></table></div>
          </Card>
        </div>
      );
    }

    // ------------------------------ PAGOS ------------------------------
    function Pagos({ pagos, alumnos, perfil, onPayMensual, clases }) {
        const [vista, setVista] = useState(perfil.metodoCobro === 'mensual' ? 'mensual' : 'historial');
        useEffect(() => {
            setVista(perfil.metodoCobro === 'mensual' ? 'mensual' : 'historial');
        }, [perfil.metodoCobro]);
        return (
            <div className="grid gap-4">
                <div className="flex items-center gap-2 bg-slate-100 p-1 rounded-xl">
                    <button onClick={() => setVista('historial')} className={`w-full text-center px-3 py-1.5 text-sm rounded-lg ${vista === 'historial' ? 'bg-white shadow' : ''}`}>Historial de Pagos</button>
                    <button onClick={() => setVista('mensual')} className={`w-full text-center px-3 py-1.5 text-sm rounded-lg ${vista === 'mensual' ? 'bg-white shadow' : ''}`}>Control Mensual</button>
                    <button onClick={() => setVista('deudas')} className={`w-full text-center px-3 py-1.5 text-sm rounded-lg ${vista === 'deudas' ? 'bg-white shadow' : ''}`}>Control de Deudas</button>
                </div>
                {vista === 'historial' && <HistorialPagos pagos={pagos} alumnos={alumnos} />}
                {vista === 'mensual' && <ControlMensual pagos={pagos} alumnos={alumnos} perfil={perfil} onPay={onPayMensual} />}
                {vista === 'deudas' && <ControlDeudas pagos={pagos} alumnos={alumnos} clases={clases} perfil={perfil} />}
            </div>
        );
    }

    function HistorialPagos({ pagos, alumnos }) {
      const [periodo, setPeriodo] = useState("mes");
      const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth());
      const [metodo, setMetodo] = useState("Todos");
      const alumnoMap = useMemo(() => new Map(alumnos.map(a => [a.id, a.nombre])), [alumnos]);
      const pagosFiltrados = useMemo(() => {
        const ahora = new Date();
        const hoy = formatDate(ahora);
        const semanaInicio = formatDate(getWeekStartDate(ahora));
        const anioActual = ahora.getFullYear();

        return pagos
          .map(p => ({ ...p, nombreAlumno: alumnoMap.get(p.alumnoId) || '??' }))
          .filter(p => {
            if (periodo === 'dia' && p.fecha !== hoy) return false;
            if (periodo === 'semana' && p.fecha < semanaInicio) return false;
            if (periodo === 'a√±o' && new Date(p.fecha).getFullYear() !== anioActual) return false;
            if (periodo === 'mes') {
              const fechaPago = new Date(p.fecha);
              if (fechaPago.getMonth() !== selectedMonth || fechaPago.getFullYear() !== anioActual) { return false; }
            }
            if (metodo !== 'Todos' && p.metodo !== metodo) return false;
            return true;
          })
          .sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
      }, [pagos, periodo, selectedMonth, metodo, alumnoMap]);
      
      const totales = useMemo(() => {
        return pagosFiltrados.reduce((acc, p) => {
          if (p.metodo !== 'Pendiente') {
            const monto = parseFloat(p.monto) || 0;
            acc.total += monto;
            if (p.metodo === 'Efectivo') acc.efectivo += monto;
            if (p.metodo === 'Transferencia') acc.transferencia += monto;
          }
          return acc;
        }, { total: 0, efectivo: 0, transferencia: 0 });
      }, [pagosFiltrados]);

      const PeriodoButton = ({ value, current, setter, children }) => (<button onClick={() => setter(value)} className={`px-3 py-1.5 text-sm rounded-lg ${current === value ? 'bg-slate-900 text-white' : 'bg-white border'}`}>{children}</button>);
      return (
        <Card title="Control de Pagos">
            <div className="grid gap-4 mb-4">
              <div className="flex flex-wrap items-center gap-2"><PeriodoButton value="dia" current={periodo} setter={setPeriodo}>Hoy</PeriodoButton><PeriodoButton value="semana" current={periodo} setter={setPeriodo}>Semana</PeriodoButton><PeriodoButton value="a√±o" current={periodo} setter={setPeriodo}>A√±o</PeriodoButton></div>
              <div className="flex flex-wrap items-center gap-2">{MESES_NOMBRES.map((mes, index) => (<button key={mes} onClick={() => { setPeriodo('mes'); setSelectedMonth(index); }} className={`px-3 py-1.5 text-sm rounded-lg ${periodo === 'mes' && selectedMonth === index ? 'bg-slate-900 text-white' : 'bg-white border'}`}>{mes}</button>))}</div>
              <div className="flex flex-wrap items-center gap-2"><PeriodoButton value="Todos" current={metodo} setter={setMetodo}>Todos</PeriodoButton><PeriodoButton value="Efectivo" current={metodo} setter={setMetodo}>Efectivo</PeriodoButton><PeriodoButton value="Transferencia" current={metodo} setter={setMetodo}>Transferencia</PeriodoButton><PeriodoButton value="Pendiente" current={metodo} setter={setMetodo}>Pendiente</PeriodoButton></div>
            </div>
            <div className="grid md:grid-cols-3 gap-4 mb-4">
              <div className="bg-emerald-50 p-4 rounded-xl"><p className="text-sm text-emerald-800">Total Ingresado</p><p className="text-2xl font-bold text-emerald-900">${totales.total.toFixed(2)}</p></div>
              <div className="bg-sky-50 p-4 rounded-xl"><p className="text-sm text-sky-800">Total en Efectivo</p><p className="text-2xl font-bold text-sky-900">${totales.efectivo.toFixed(2)}</p></div>
              <div className="bg-indigo-50 p-4 rounded-xl"><p className="text-sm text-indigo-800">Total por Transferencia</p><p className="text-2xl font-bold text-indigo-900">${totales.transferencia.toFixed(2)}</p></div>
            </div>
            <div className="overflow-x-auto"><table className="min-w-full text-sm"><thead><tr className="text-left text-slate-600"><th className="p-2">Fecha</th><th className="p-2">Concepto</th><th className="p-2">Monto</th><th className="p-2">M√©todo</th></tr></thead><tbody>{pagosFiltrados.length === 0 && (<tr><td colSpan={4} className="text-center py-6 text-slate-400">No hay pagos que coincidan con los filtros</td></tr>)}{pagosFiltrados.map(p => (<tr key={p.id} className="border-t"><td className="p-2">{p.fecha}</td><td className="p-2">{p.concepto || p.nombreAlumno}</td><td className="p-2">${p.monto}</td><td className="p-2"><span className={`px-2 py-0.5 rounded-full text-xs ${p.metodo === 'Pendiente' ? 'bg-orange-100 text-orange-800' : 'bg-green-100 text-green-800'}`}>{p.metodo}</span></td></tr>))}</tbody></table></div>
        </Card>
      );
    }

    function ControlMensual({ pagos, alumnos, perfil, onPay }) {
        const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth());
        const alumnosMensuales = useMemo(() => alumnos.filter(a => a.plan === 'mensual' && a.estado === 'activo'), [alumnos]);
        const statusMensual = useMemo(() => {
            const anioActual = new Date().getFullYear();
            const pagosDelMes = pagos.filter(p => {
                const fechaPago = new Date(p.fecha);
                return p.concepto?.startsWith("Cuota Mensual") && fechaPago.getMonth() === selectedMonth && fechaPago.getFullYear() === anioActual;
            });

            return alumnosMensuales.map(alumno => {
                const cuota = parseFloat(perfil.preciosMensuales[alumno.frecuencia] || 0);
                const pagosAlumno = pagosDelMes.filter(p => p.alumnoId === alumno.id);
                const totalPagado = pagosAlumno.reduce((acc, p) => acc + parseFloat(p.monto), 0);
                
                let estado = 'Pendiente';
                if (totalPagado >= cuota) {
                    estado = 'Pagado';
                } else if (totalPagado > 0) {
                    estado = 'Parcial';
                }

                return {
                    ...alumno,
                    cuota,
                    totalPagado,
                    estado
                };
            });
        }, [alumnosMensuales, pagos, selectedMonth, perfil.preciosMensuales]);

        const getStatusColor = (status) => {
            if (status === 'Pagado') return 'bg-green-100 text-green-800';
            if (status === 'Parcial') return 'bg-yellow-100 text-yellow-800';
            return 'bg-red-100 text-red-800';
        };
        return (
            <Card title="Control de Cuotas Mensuales">
                <div className="flex flex-wrap items-center gap-2 mb-4">
                    {MESES_NOMBRES.map((mes, index) => (
                        <button key={mes} onClick={() => setSelectedMonth(index)} className={`px-3 py-1.5 text-sm rounded-lg ${selectedMonth === index ? 'bg-slate-900 text-white' : 'bg-white border'}`}>{mes}</button>
                    ))}
                </div>
                <div className="overflow-x-auto"><table className="min-w-full text-sm"><thead><tr className="text-left text-slate-600"><th className="p-2">Alumno</th><th className="p-2">Plan</th><th className="p-2">Monto Cuota</th><th className="p-2">Monto Pagado</th><th className="p-2">Estado</th><th className="p-2 text-right">Acciones</th></tr></thead><tbody>
                    {statusMensual.length === 0 && (<tr><td colSpan={6} className="text-center py-6 text-slate-400">No hay alumnos con plan mensual</td></tr>)}
                    {statusMensual.map(a => (
                        <tr key={a.id} className="border-t">
                            <td className="p-2">{a.nombre}</td>
                            <td className="p-2">{FRECUENCIAS_MENSUALES.find(f => f.value === a.frecuencia)?.label}</td>
                            <td className="p-2">${a.cuota.toFixed(2)}</td>
                            <td className="p-2">${a.totalPagado.toFixed(2)}</td>
                            <td className="p-2"><span className={`px-2 py-0.5 rounded-full text-xs ${getStatusColor(a.estado)}`}>{a.estado}</span></td>
                            <td className="p-2 text-right">
                                {a.estado !== 'Pagado' && <button onClick={() => onPay(a, selectedMonth)} className="px-2 py-1 text-xs rounded-lg border bg-emerald-500 text-white">Registrar Pago</button>}
                            </td>
                        </tr>
                    ))}
                </tbody></table></div>
            </Card>
        );
    }

    function ControlDeudas({ pagos, alumnos, clases, perfil }) {
        const deudas = useMemo(() => {
            const deudores = [];
            const hoy = new Date();
            const mesActual = hoy.getMonth();
            const anioActual = hoy.getFullYear();

            // Deudas mensuales
            const alumnosMensuales = alumnos.filter(a => a.plan === 'mensual' && a.estado === 'activo');
            const pagosMensuales = pagos.filter(p => p.concepto?.startsWith("Cuota Mensual"));

            alumnosMensuales.forEach(alumno => {
                const cuota = parseFloat(perfil.preciosMensuales[alumno.frecuencia] || 0);
                const pagosDelMes = pagosMensuales.filter(p => {
                    const fechaPago = new Date(p.fecha);
                    return p.alumnoId === alumno.id && fechaPago.getMonth() === mesActual && fechaPago.getFullYear() === anioActual;
                });
                const totalPagado = pagosDelMes.reduce((acc, p) => acc + parseFloat(p.monto), 0);
                const deuda = cuota - totalPagado;
                if (deuda > 0) {
                    deudores.push({ id: alumno.id, nombre: alumno.nombre, tipo: 'Cuota Mensual', monto: deuda });
                }
            });

            // Deudas por clase
            const pagosPorClaseMap = new Map(pagos.filter(p => p.claseId).map(p => [p.claseId, p]));
            const clasesRealizadas = clases.filter(c => c.estado === 'Realizada' && new Date(c.fecha) <= hoy);
            
            clasesRealizadas.forEach(clase => {
                if (!pagosPorClaseMap.has(clase.id)) {
                    clase.alumnoIds.forEach(alumnoId => {
                        const alumno = alumnos.find(a => a.id === alumnoId);
                        if (alumno && alumno.plan === 'porClase') {
                            const monto = parseFloat(clase.precio) / clase.alumnoIds.length;
                            deudores.push({ id: `${clase.id}-${alumno.id}`, nombre: alumno.nombre, tipo: `Clase ${clase.fecha}`, monto });
                        }
                    });
                }
            });
            
            // Agrupar deudas por alumno
            const deudasAgrupadas = deudores.reduce((acc, deuda) => {
                if(!acc[deuda.nombre]) {
                    acc[deuda.nombre] = { total: 0, detalles: [] };
                }
                acc[deuda.nombre].total += deuda.monto;
                acc[deuda.nombre].detalles.push({ tipo: deuda.tipo, monto: deuda.monto });
                return acc;
            }, {});
            
            return Object.entries(deudasAgrupadas).map(([nombre, data]) => ({ nombre, ...data }));

        }, [pagos, alumnos, clases, perfil]);
        
        return (
            <Card title="Control de Deudas Pendientes">
                 <div className="overflow-x-auto"><table className="min-w-full text-sm"><thead><tr className="text-left text-slate-600"><th className="p-2">Alumno</th><th className="p-2">Detalle de Deuda</th><th className="p-2">Total Adeudado</th></tr></thead><tbody>
                    {deudas.length === 0 && (<tr><td colSpan={3} className="text-center py-6 text-slate-400">No hay deudas pendientes</td></tr>)}
                    {deudas.map(deuda => (
                        <tr key={deuda.nombre} className="border-t">
                            <td className="p-2 font-semibold">{deuda.nombre}</td>
                            <td className="p-2">
                                {deuda.detalles.map((d, i) => (
                                    <div key={i}>{d.tipo}: ${d.monto.toFixed(2)}</div>
                                ))}
                            </td>
                            <td className="p-2 font-semibold text-red-600">${deuda.total.toFixed(2)}</td>
                        </tr>
                    ))}
                </tbody></table></div>
            </Card>
        );
    }


    // ------------------------------ GASTOS ------------------------------
    function Gastos({ gastos, onCreate, onUpdate, onDelete }) {
      const [showForm, setShowForm] = useState(false);
      const [editing, setEditing] = useState(null);
      const emptyForm = { fecha: formatDate(new Date()), concepto: "", monto: "", categoria: "Varios" };
      const [form, setForm] = useState(emptyForm);
      const [periodo, setPeriodo] = useState("mes");
      const handleChange = (e) => { const { name, value } = e.target; setForm(prev => ({ ...prev, [name]: value })); };

      const gastosFiltrados = useMemo(() => {
        const ahora = new Date();
        const hoy = formatDate(ahora);
        const semanaInicio = formatDate(getWeekStartDate(ahora));
        const mesInicio = formatDate(new Date(ahora.getFullYear(), ahora.getMonth(), 1));
        const anioInicio = formatDate(new Date(ahora.getFullYear(), 0, 1));

        return gastos
          .filter(g => {
            if (periodo === 'dia' && g.fecha !== hoy) return false;
            if (periodo === 'semana' && g.fecha < semanaInicio) return false;
            if (periodo === 'mes' && g.fecha < mesInicio) return false;
            if (periodo === 'a√±o' && g.fecha < anioInicio) return false;
            return true;
          })
          .sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
      }, [gastos, periodo]);
      
      const totalGastos = useMemo(() => gastosFiltrados.reduce((acc, g) => acc + (parseFloat(g.monto) || 0), 0), [gastosFiltrados]);

      function openNew() { setEditing(null); setForm(emptyForm); setShowForm(true); }
      function openEdit(g) { setEditing(g); setForm(g); setShowForm(true); }
      function cancel() { setShowForm(false); setEditing(null); setForm(emptyForm); }
      function submit(e) { e.preventDefault(); if (!form.concepto.trim() || !form.monto) return alert("Complet√° concepto y monto"); if (editing) { onUpdate({ ...editing, ...form }); } else { onCreate({ id: uid(), ...form }); } cancel(); }

      const PeriodoButton = ({ value, current, setter, children }) => (<button onClick={() => setter(value)} className={`px-3 py-1.5 text-sm rounded-lg ${current === value ? 'bg-slate-900 text-white' : 'bg-white border'}`}>{children}</button>);
      return (
        <div className="grid gap-4">
          <Card title={editing ? "Editar gasto" : "Nuevo gasto"} right={!showForm && <button onClick={openNew} className="bg-slate-900 text-white text-sm px-3 py-1.5 rounded-xl">+ Nuevo</button>}>
            {showForm ? (
              <form onSubmit={submit} className="grid md:grid-cols-6 gap-3">
                <div className="md:col-span-2"><label className="text-sm text-slate-600">Fecha</label><input type="date" name="fecha" value={form.fecha} onChange={handleChange} className="w-full border rounded-lg px-3 py-2" required /></div>
                <div className="md:col-span-4"><label className="text-sm text-slate-600">Concepto</label><input name="concepto" value={form.concepto} onChange={handleChange} className="w-full border rounded-lg px-3 py-2" placeholder="Ej: Compra de pelotas" required /></div>
                <div><label className="text-sm text-slate-600">Monto</label><input type="number" name="monto" value={form.monto} onChange={handleChange} className="w-full border rounded-lg px-3 py-2" placeholder="Ej: 10000" required /></div>
                <div><label className="text-sm text-slate-600">Categor√≠a</label><select name="categoria" value={form.categoria} onChange={handleChange} className="w-full border rounded-lg px-3 py-2">{CATEGORIAS_GASTO.map(c => <option key={c}>{c}</option>)}</select></div>
                <div className="md:col-span-6 flex gap-2 justify-end"><button type="button" onClick={cancel} className="px-3 py-2 rounded-lg border">Cancelar</button><button className="px-3 py-2 rounded-lg bg-emerald-600 text-white">Guardar</button></div>
              </form>
            ) : (<p className="text-sm text-slate-500">Hac√© clic en <b>+ Nuevo</b> para registrar un gasto.</p>)}
          </Card>
          
          <Card title="Control de Gastos">
            <div className="flex flex-wrap items-center gap-2 mb-4">
              <PeriodoButton value="dia" current={periodo} setter={setPeriodo}>Hoy</PeriodoButton>
              <PeriodoButton value="semana" current={periodo} setter={setPeriodo}>Semana</PeriodoButton>
              <PeriodoButton value="mes" current={periodo} setter={setPeriodo}>Mes</PeriodoButton>
              <PeriodoButton value="a√±o" current={periodo} setter={setPeriodo}>A√±o</PeriodoButton>
            </div>
            <div className="bg-red-50 p-4 rounded-xl mb-4"><p className="text-sm text-red-800">Total de Gastos</p><p className="text-2xl font-bold text-red-900">${totalGastos.toFixed(2)}</p></div>
            <div className="overflow-x-auto"><table className="min-w-full text-sm"><thead><tr className="text-left text-slate-600"><th className="p-2">Fecha</th><th className="p-2">Concepto</th><th className="p-2">Monto</th><th className="p-2">Categor√≠a</th><th className="p-2 text-right">Acciones</th></tr></thead><tbody>{gastosFiltrados.length === 0 && (<tr><td colSpan={5} className="text-center py-6 text-slate-400">No hay gastos en este per√≠odo</td></tr>)}{gastosFiltrados.map(g => (<tr key={g.id} className="border-t"><td className="p-2">{g.fecha}</td><td className="p-2">{g.concepto}</td><td className="p-2">${g.monto}</td><td className="p-2">{g.categoria}</td><td className="p-2 text-right"><div className="inline-flex gap-2"><button onClick={() => openEdit(g)} className="px-2 py-1 text-xs rounded-lg border hover:bg-slate-50">‚úèÔ∏è Editar</button><button type="button" onClick={() => onDelete(g.id)} className="px-2 py-1 text-xs rounded-lg border text-red-600 hover:bg-red-50">üóëÔ∏è Eliminar</button></div></td></tr>))}</tbody></table></div>
          </Card>
        </div>
      );
    }

    // ------------------------------ GR√ÅFICO DE BARRAS ------------------------------
    function GraficoBarras({ data }) {
      const maxValue = useMemo(() => {
        const values = data.map(d => d.value);
        return Math.max(...values, 1); // Evitar divisi√≥n por cero
      }, [data]);
      return (
        <div className="bg-slate-50 rounded-xl p-4 h-64 flex justify-around items-end gap-4">
          {data.map(item => (
            <div key={item.label} className="flex-1 flex flex-col items-center gap-2">
              <div className="text-sm font-semibold text-slate-700">${item.value.toFixed(2)}</div>
              <div
                className={`w-full rounded-t-lg ${item.color}`}
                style={{ height: `${(item.value / maxValue) * 80}%` }}
                title={`${item.label}: $${item.value.toFixed(2)}`}
              ></div>
              <div className="text-xs font-medium text-slate-600">{item.label}</div>
            </div>
          ))}
        </div>
      );
    }

    // ------------------------------ REPORTES ------------------------------
    function Reportes({ pagos, gastos, alumnos }) {
      const [periodo, setPeriodo] = useState("mes");
      const alumnoMap = useMemo(() => new Map(alumnos.map(a => [a.id, a.nombre])), [alumnos]);
      const [pagosFiltrados, gastosFiltrados] = useMemo(() => {
        const ahora = new Date();
        const hoy = formatDate(ahora);
        const semanaInicio = formatDate(getWeekStartDate(ahora));
        const mesInicio = formatDate(new Date(ahora.getFullYear(), ahora.getMonth(), 1));
        const anioInicio = formatDate(new Date(ahora.getFullYear(), 0, 1));

        const filterByPeriod = (item) => {
          if (periodo === 'dia' && item.fecha !== hoy) return false;
          if (periodo === 'semana' && item.fecha < semanaInicio) return false;
          if (periodo === 'mes' && item.fecha < mesInicio) return false;
          if (periodo === 'a√±o' && item.fecha < anioInicio) return false;
          return true;
        };

        return [pagos.filter(filterByPeriod), gastos.filter(filterByPeriod)];
      }, [pagos, gastos, periodo]);
      
      const totales = useMemo(() => {
        const totalIngresos = pagosFiltrados
          .filter(p => p.metodo !== 'Pendiente')
          .reduce((acc, p) => acc + (parseFloat(p.monto) || 0), 0);
        
        const totalGastos = gastosFiltrados
          .reduce((acc, g) => acc + (parseFloat(g.monto) || 0), 0);

        return {
          ingresos: totalIngresos,
          gastos: totalGastos,
          balance: totalIngresos - totalGastos,
        };
      }, [pagosFiltrados, gastosFiltrados]);
      
      const dataGrafico = [
        { label: 'Ingresos', value: totales.ingresos, color: 'bg-emerald-400' },
        { label: 'Gastos', value: totales.gastos, color: 'bg-red-400' },
      ];
      
      const handleExport = () => {
        if (!window.jspdf || !window.jspdf.jsPDF) {
            alert("Error: La librer√≠a jsPDF no est√° cargada.");
            return;
        }
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        const pageTitle = `Reporte Financiero - Per√≠odo: ${periodo.charAt(0).toUpperCase() + periodo.slice(1)}`;
        const generatedDate = `Generado el: ${new Date().toLocaleDateString()}`;

        doc.setFontSize(18);
        doc.text(pageTitle, 14, 22);
        doc.setFontSize(11);
        doc.setTextColor(100);
        doc.text(generatedDate, 14, 29);

        doc.setFontSize(12);
        doc.text("Resumen del Per√≠odo", 14, 45);
        const summaryText = `Total Ingresos: $${totales.ingresos.toFixed(2)}\nTotal Gastos: $${totales.gastos.toFixed(2)}\nBalance Neto: $${totales.balance.toFixed(2)}`;
        doc.text(summaryText, 14, 52);
        
        const tableColumn = ["Fecha", "Tipo", "Concepto", "Monto", "Metodo/Categoria"];
        const tableRows = [];
        
        pagosFiltrados.forEach(pago => {
            const alumnoNombre = alumnoMap.get(pago.alumnoId) || "N/A";
            const concepto = pago.concepto || `Clase ${alumnoNombre}`;
            const pagoData = [
                pago.fecha,
                "Ingreso",
                concepto,
                `$${parseFloat(pago.monto).toFixed(2)}`,
                pago.metodo
            ];
            tableRows.push(pagoData);
        });
        
        gastosFiltrados.forEach(gasto => {
            const gastoData = [
                gasto.fecha,
                "Gasto",
                gasto.concepto,
                `$${parseFloat(gasto.monto).toFixed(2)}`,
                gasto.categoria
            ];
            tableRows.push(gastoData);
        });
        
        doc.autoTable({
            head: [tableColumn],
            body: tableRows,
            startY: 70,
        });
        
        doc.save(`reporte_${periodo}_${formatDate(new Date())}.pdf`);
      };

      const PeriodoButton = ({ value, current, setter, children }) => (<button onClick={() => setter(value)} className={`px-3 py-1.5 text-sm rounded-lg ${current === value ? 'bg-slate-900 text-white' : 'bg-white border'}`}>{children}</button>);
      return (
        <div className="grid gap-4">
          <Card title="Reporte Financiero">
            <div className="flex flex-wrap items-center gap-2 mb-4">
              <PeriodoButton value="dia" current={periodo} setter={setPeriodo}>Hoy</PeriodoButton>
              <PeriodoButton value="semana" current={periodo} setter={setPeriodo}>Semana</PeriodoButton>
              <PeriodoButton value="mes" current={periodo} setter={setPeriodo}>Mes</PeriodoButton>
              <PeriodoButton value="a√±o" current={periodo} setter={setPeriodo}>A√±o</PeriodoButton>
              <button onClick={handleExport} className="px-3 py-1.5 text-sm rounded-lg bg-emerald-600 text-white ml-auto">Exportar a PDF</button>
            </div>
            
            <div className="grid md:grid-cols-3 gap-4 mb-6">
              <div className="bg-emerald-50 p-4 rounded-xl"><p className="text-sm text-emerald-800">Total Ingresos</p><p className="text-2xl font-bold text-emerald-900">${totales.ingresos.toFixed(2)}</p></div>
              <div className="bg-red-50 p-4 rounded-xl"><p className="text-sm text-red-800">Total Gastos</p><p className="text-2xl font-bold text-red-900">${totales.gastos.toFixed(2)}</p></div>
              <div className="bg-blue-50 p-4 rounded-xl"><p className="text-sm text-blue-800">Balance Neto</p><p className={`text-2xl font-bold ${totales.balance >= 0 ? 'text-blue-900' : 'text-red-900'}`}>${totales.balance.toFixed(2)}</p></div>
            </div>

            <div className="mb-6">
                <h4 className="text-md font-semibold text-slate-700 mb-2">Resumen Gr√°fico</h4>
                <GraficoBarras data={dataGrafico} />
            </div>

            <div className="grid md:grid-cols-2 gap-4">
              <div>
                <h4 className="text-md font-semibold text-slate-700 mb-2">Desglose de Ingresos</h4>
                <div className="overflow-x-auto border rounded-xl"><table className="min-w-full text-sm"><thead><tr className="text-left text-slate-600"><th className="p-2">Fecha</th><th className="p-2">Monto</th><th className="p-2">M√©todo</th></tr></thead><tbody>{pagosFiltrados.length === 0 && (<tr><td colSpan={3} className="text-center py-4 text-slate-400">Sin ingresos</td></tr>)}{pagosFiltrados.map(p => (<tr key={p.id} className="border-t"><td className="p-2">{p.fecha}</td><td className="p-2">${p.monto}</td><td className="p-2">{p.metodo}</td></tr>))}</tbody></table></div>
              </div>
              <div>
                <h4 className="text-md font-semibold text-slate-700 mb-2">Desglose de Gastos</h4>
                <div className="overflow-x-auto border rounded-xl"><table className="min-w-full text-sm"><thead><tr className="text-left text-slate-600"><th className="p-2">Fecha</th><th className="p-2">Concepto</th><th className="p-2">Monto</th></tr></thead><tbody>{gastosFiltrados.length === 0 && (<tr><td colSpan={3} className="text-center py-4 text-slate-400">Sin gastos</td></tr>)}{gastosFiltrados.map(g => (<tr key={g.id} className="border-t"><td className="p-2">{g.fecha}</td><td className="p-2">{g.concepto}</td><td className="p-2">${g.monto}</td></tr>))}</tbody></table></div>
              </div>
            </div>
          </Card>
        </div>
      );
    }

    // ------------------------------ PERFIL ------------------------------
    function Perfil({ perfil, onUpdate }) {
      const [form, setForm] = useState(perfil);
      const handleChange = (e) => {
        const { name, value } = e.target;
        setForm(prev => ({ ...prev, [name]: value }));
      };

      const handlePrecioChange = (e) => {
        const { name, value } = e.target;
        setForm(prev => ({ ...prev, precios: { ...prev.precios, [name]: value } }));
      };
      const handlePrecioMensualChange = (e) => {
        const { name, value } = e.target;
        setForm(prev => ({ ...prev, preciosMensuales: { ...prev.preciosMensuales, [name]: value } }));
      };
      const handleSubmit = (e) => {
        e.preventDefault();
        onUpdate(form);
      };
      return (
        <form onSubmit={handleSubmit}>
          <Card title="Perfil y Configuraci√≥n">
            <div className="grid md:grid-cols-2 gap-6">
              {/* Datos Personales */}
              <div>
                <h4 className="text-md font-semibold text-slate-700 mb-2">Datos Personales</h4>
                <div className="grid gap-3">
                  <div><label className="text-sm text-slate-600">Nombre</label><input name="nombre" value={form.nombre} onChange={handleChange} className="w-full border rounded-lg px-3 py-2" /></div>
                  <div><label className="text-sm text-slate-600">Apellido</label><input name="apellido" value={form.apellido} onChange={handleChange} className="w-full border rounded-lg px-3 py-2" /></div>
                  <div><label className="text-sm text-slate-600">Tel√©fono</label><input name="telefono" value={form.telefono} onChange={handleChange} className="w-full border rounded-lg px-3 py-2" /></div>
                </div>
              </div>
              {/* Precios de Clases */}
              <div>
                <h4 className="text-md font-semibold text-slate-700 mb-2">Precios por Clase</h4>
                <div className="grid grid-cols-2 gap-3">
                  <div><label className="text-sm text-slate-600">Individual</label><input type="number" name="individual" value={form.precios.individual} onChange={handlePrecioChange} className="w-full border rounded-lg px-3 py-2" /></div>
                  <div><label className="text-sm text-slate-600">Dupla</label><input type="number" name="dupla" value={form.precios.dupla} onChange={handlePrecioChange} className="w-full border rounded-lg px-3 py-2" /></div>
                  <div><label className="text-sm text-slate-600">Tr√≠o</label><input type="number" name="trio" value={form.precios.trio} onChange={handlePrecioChange} className="w-full border rounded-lg px-3 py-2" /></div>
                  <div><label className="text-sm text-slate-600">Cuarteto</label><input type="number" name="cuarteto" value={form.precios.cuarteto} onChange={handlePrecioChange} className="w-full border rounded-lg px-3 py-2" /></div>
                  <div className="col-span-2"><label className="text-sm text-slate-600">Escuelita</label><input type="number" name="escuelita" value={form.precios.escuelita} onChange={handlePrecioChange} className="w-full border rounded-lg px-3 py-2" /></div>
                </div>
              </div>
            </div>
            <div className="mt-6 border-t pt-6">
                <h4 className="text-md font-semibold text-slate-700 mb-2">Precios Mensuales</h4>
                <div className="grid md:grid-cols-2 gap-3">
                    {FRECUENCIAS_MENSUALES.map(f => (
                        <div key={f.value}><label className="text-sm text-slate-600">{f.label}</label><input type="number" name={f.value} value={form.preciosMensuales[f.value]} onChange={handlePrecioMensualChange} className="w-full border rounded-lg px-3 py-2" /></div>
                    ))}
                </div>
            </div>
            <div className="mt-6 border-t pt-6">
              <h4 className="text-md font-semibold text-slate-700 mb-2">Modalidad de Cobro Principal</h4>
              <select name="metodoCobro" value={form.metodoCobro} onChange={handleChange} className="w-full border rounded-lg px-3 py-2">
                <option value="porClase">Por Clase</option>
                <option value="mensual">Mensual</option>
              </select>
            </div>
            <div className="mt-6 border-t pt-6">
                <h4 className="text-md font-semibold text-slate-700 mb-2">Canchas / Ubicaciones</h4>
                <textarea name="canchas" value={form.canchas} onChange={handleChange} className="w-full border rounded-lg px-3 py-2" rows={4} placeholder="Una ubicaci√≥n por l√≠nea..."></textarea>
            </div>
            <div className="mt-6 flex justify-end">
              <button type="submit" className="px-4 py-2 rounded-lg bg-emerald-600 text-white">Guardar Cambios</button>
            </div>
          </Card>
        </form>
      );
    }


    // ------------------------------ MODALES DE PAGO ------------------------------
    function PagoModal({ isOpen, clase, onCancel, onSave }) {
      const [form, setForm] = useState({ monto: "", metodo: "Efectivo" });
      useEffect(() => { if (clase) { setForm({ monto: clase.precio || "", metodo: "Efectivo" }); } }, [clase]);
      if (!isOpen || !clase) return null;
      const handleSave = () => { onSave({ ...form, monto: form.monto || "0" }); };
      return (
        <Modal isOpen={isOpen} title={`Registrar Pago: ${clase.nombresAlumnos}`} onCancel={onCancel} onConfirm={handleSave} confirmText="Guardar Pago">
          <div className="grid gap-4">
            <p>Clase del {clase.fecha} a las {clase.hora}.</p>
            <div><label className="text-sm text-slate-600">Monto</label><input type="number" value={form.monto} onChange={(e) => setForm({...form, monto: e.target.value})} className="w-full border rounded-lg px-3 py-2" placeholder="0.00" /></div>
            <div><label className="text-sm text-slate-600">M√©todo de Pago</label><select value={form.metodo} onChange={(e) => setForm({...form, metodo: e.target.value})} className="w-full border rounded-lg px-3 py-2">{METODOS_PAGO.map(m => <option key={m}>{m}</option>)}</select></div>
          </div>
        </Modal>
      );
    }

    function PagoMensualModal({ isOpen, alumno, mes, onCancel, onSave }) {
      const [form, setForm] = useState({ monto: "", metodo: "Efectivo" });
      useEffect(() => {
        if (alumno) {
          const restante = alumno.cuota - alumno.totalPagado;
          setForm({ monto: restante > 0 ? restante.toFixed(2) : "", metodo: "Efectivo" });
        }
      }, [alumno]);
      if (!isOpen || !alumno) return null;

      const handleSave = () => { onSave({ ...form, monto: form.monto || "0" }); };
      return (
        <Modal isOpen={isOpen} title={`Pago Cuota: ${alumno.nombre}`} onCancel={onCancel} onConfirm={handleSave} confirmText="Guardar Pago">
          <div className="grid gap-4">
            <p>Cuota de {MESES_NOMBRES[mes]} por ${alumno.cuota.toFixed(2)}. Pagado: ${alumno.totalPagado.toFixed(2)}.</p>
            <div><label className="text-sm text-slate-600">Monto a Pagar</label><input type="number" value={form.monto} onChange={(e) => setForm({...form, monto: e.target.value})} className="w-full border rounded-lg px-3 py-2" placeholder="0.00" /></div>
            <div><label className="text-sm text-slate-600">M√©todo de Pago</label><select value={form.metodo} onChange={(e) => setForm({...form, metodo: e.target.value})} className="w-full border rounded-lg px-3 py-2">{METODOS_PAGO.map(m => <option key={m}>{m}</option>)}</select></div>
          </div>
        </Modal>
      );
    }


    // ------------------------------ APP ------------------------------
    function AppGPadel() {
      const [current, setCurrent] = useState("dashboard");
      const [state, setState] = useLocalState();
      const [toast, setToast] = useState("");
      const [deletingInfo, setDeletingInfo] = useState({ id: null, type: null });
      const [payingClase, setPayingClase] = useState(null);
      const [payingCuota, setPayingCuota] = useState({alumno: null, mes: null});

      const alumnoCrud = { create: (a) => { setState((s) => ({ ...s, alumnos: [...s.alumnos, a] })); setToast("Alumno creado"); }, update: (a) => { setState((s) => ({ ...s, alumnos: s.alumnos.map(x => x.id === a.id ? { ...x, ...a } : x) })); setToast("Alumno actualizado"); }, delete: (id) => { setDeletingInfo({ id, type: 'alumno' }); }, };
      const claseCrud = { 
        create: (c) => { 
            if (c.recurrente) {
                const nuevasClases = Array.from({ length: 12 }).map((_, i) => {
                    const nuevaFecha = addDays(new Date(c.fecha), i * 7);
                    return { ...c, id: uid(), fecha: formatDate(nuevaFecha), recurrente: false };
                });
                setState(s => ({ ...s, clases: [...s.clases, ...nuevasClases] }));
                setToast("Clases recurrentes creadas");
            } else {
                setState((s) => ({ ...s, clases: [...s.clases, { ...c, id: uid() }] }));
                setToast("Clase creada");
            }
        }, 
        update: (c) => { setState((s) => ({ ...s, clases: s.clases.map(x => x.id === c.id ? c : x) })); setToast("Clase actualizada"); }, 
        delete: (id) => { setDeletingInfo({ id, type: 'clase' }); }, 
        onPay: (clase) => { setPayingClase(clase); } 
      };
      const pagoCrud = { 
        create: (pagoData) => { const newPago = { id: uid(), claseId: payingClase.id, alumnoId: payingClase.alumnoIds[0], fecha: payingClase.fecha, ...pagoData }; setState(s => ({ ...s, pagos: [...s.pagos, newPago] })); setToast("Pago registrado"); setPayingClase(null); },
        createMensual: (pagoData) => { const { alumno, mes } = payingCuota; const fecha = new Date(); fecha.setMonth(mes); const newPago = { id: uid(), alumnoId: alumno.id, fecha: formatDate(fecha), concepto: `Cuota Mensual - ${MESES_NOMBRES[mes]}`, ...pagoData }; setState(s => ({ ...s, pagos: [...s.pagos, newPago] })); setToast("Pago de cuota registrado"); setPayingCuota({alumno: null, mes: null}); }
      };
      const gastoCrud = { create: (g) => { setState((s) => ({ ...s, gastos: [...s.gastos, g] })); setToast("Gasto creado"); }, update: (g) => { setState((s) => ({ ...s, gastos: s.gastos.map(x => x.id === g.id ? g : x) })); setToast("Gasto actualizado"); }, delete: (id) => { setDeletingInfo({ id, type: 'gasto' }); }, };
      const perfilCrud = { update: (p) => { setState(s => ({ ...s, perfil: p })); setToast("Perfil actualizado"); } };
      
      const confirmDelete = () => {
        const { id, type } = deletingInfo;
        if (!id || !type) return;
        if (type === 'alumno') { setState((s) => ({ ...s, alumnos: s.alumnos.filter(x => x.id !== id) })); setToast("Alumno eliminado"); } 
        else if (type === 'clase') { setState((s) => ({ ...s, clases: s.clases.filter(x => x.id !== id) })); setToast("Clase eliminada"); }
        else if (type === 'gasto') { setState((s) => ({ ...s, gastos: s.gastos.filter(x => x.id !== id) })); setToast("Gasto eliminado"); }
        setDeletingInfo({ id: null, type: null });
      };
      
      useEffect(() => {
        if (state.alumnos.length === 0) {
          const a1 = { id: uid(), nombre: "Juan L√≥pez", telefono: "5493815551111", deporte: "P√°del", estado: "activo", plan: "mensual", frecuencia: "2xSemana", notas: "Drive", horarios: [] };
          const a2 = { id: uid(), nombre: "Ana Ruiz", telefono: "5493815552222", deporte: "Tenis", estado: "activo", plan: "porClase", notas: "", horarios: [] };
          const a3 = { id: uid(), nombre: "Carlos Vera", telefono: "5493815553333", deporte: "P√°del", estado: "activo", plan: "mensual", frecuencia: "1xSemana", notas: "", horarios: [] };
          setState((s) => ({ ...s, alumnos: [a1, a2, a3] }));
        }
      }, []);
      
      return (
        <div className="min-h-screen bg-slate-50 font-sans">
          <Topbar current={current} setCurrent={setCurrent} />
          <main className="max-w-6xl mx-auto px-4 py-6 grid gap-4">
            {current === "dashboard" && <Dashboard state={state} />}
            {current === "alumnos" && <Alumnos alumnos={state.alumnos} onCreate={alumnoCrud.create} onUpdate={alumnoCrud.update} onDelete={alumnoCrud.delete} />}
            {current === "clases" && <Clases clases={state.clases} alumnos={state.alumnos} pagos={state.pagos} perfil={state.perfil} onCreate={claseCrud.create} onUpdate={claseCrud.update} onDelete={claseCrud.delete} onPay={claseCrud.onPay} />}
            {current === "pagos" && <Pagos pagos={state.pagos} alumnos={state.alumnos} clases={state.clases} perfil={state.perfil} onPayMensual={(alumno, mes) => setPayingCuota({alumno, mes})} />}
            {current === "gastos" && <Gastos gastos={state.gastos} onCreate={gastoCrud.create} onUpdate={gastoCrud.update} onDelete={gastoCrud.delete} />}
            {current === "reportes" && <Reportes pagos={state.pagos} gastos={state.gastos} alumnos={state.alumnos} />}
            {current === "perfil" && <Perfil perfil={state.perfil} onUpdate={perfilCrud.update} />}
          </main>
          <Toast msg={toast} onClose={() => setToast("")} />
          <Modal isOpen={!!deletingInfo.id} title={`Eliminar ${deletingInfo.type}`} onConfirm={confirmDelete} onCancel={() => setDeletingInfo({ id: null, type: null })} >
            ¬øEst√°s seguro? Esta acci√≥n no se puede deshacer.
          </Modal>
          <PagoModal isOpen={!!payingClase} clase={payingClase} onCancel={() => setPayingClase(null)} onSave={pagoCrud.create} />
          <PagoMensualModal isOpen={!!payingCuota.alumno} alumno={payingCuota.alumno} mes={payingCuota.mes} onCancel={() => setPayingCuota({alumno: null, mes: null})} onSave={pagoCrud.createMensual} />
          <footer className="text-center text-xs text-slate-500 py-6">Demo local ¬∑ Luego integramos Firebase (Auth + Firestore)</footer>
        </div>
      );
    }
    
    // --- FIN DEL C√ìDIGO DE LA APLICACI√ìN ---

    // Renderiza el componente principal "AppGPadel" en el div con id "root"
    ReactDOM.render(<AppGPadel />, document.getElementById('root'));
  </script>

</body>
</html>
