<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coachex-Pro – Gestión de Profesores</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
  
  <!-- SDK de Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 2s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  
  <div id="root"></div>

  <script type="text/babel">
    // --- INICIO DEL CÓDIGO DE LA APLICACIÓN ---

    const { useEffect, useMemo, useState } = React;

    /**
     * Gestión de Pádel – MVP en React (Canvas) - v25 (Final con correcciones)
     *
     * Cambios aplicados:
     * - (FIX) Reestructuración final del código para solucionar ReferenceError.
     * Todas las constantes y componentes se definen ahora antes de ser invocados.
     */

    // ------------------------------ Configuración de Firebase ------------------------------
    const firebaseConfig = {
      apiKey: "AIzaSyDU33ryp3wkbx0oJdhjC6pG3VkfNiqGk0Q",
      authDomain: "coachex-b1d9b.firebaseapp.com",
      projectId: "coachex-b1d9b",
      storageBucket: "coachex-b1d9b.appspot.com",
      messagingSenderId: "894665560100",
      appId: "1:894665560100:web:e8a61e0849f7675e1f88b1"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    // ------------------------------ Constantes, Utilidades y Logos ------------------------------
    const logoCircularBase64 = "data:image/png;base64,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";
    const logoCoachexBase64 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAakAAAAhCAYAAADf3/kYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjEuNWRHWFIAABNqSURBVHhe7Z1tExtHFsZ/7iTbcBu3A0iAJEACyE0AERAgkECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAIElE/zQd4m16k027kBCwA5gB7AD2AHsALYTWP0N2mF5P/vX5n0d2A7sALYDW997D2A7sF2w/T2fB8AOYTsw/fXlYwdhB7ADWE2r7bJm5f348x3YDrCagD2w3l5kO7AD2AHsAI4DWy5tD2AHsANs8w/sQhL/j32P+9eM24TtwDbQeD9kYDewXfD8Y4f/O+wHdgBbP8f97uEHewBdhD/N+F/9f6/k/Qf8H/sM/6f//vf2P6/P8I+5uL8v//882/w/9X/83P+v0v//0n///z/Z2f+n/j/n//93/n/z//3/3L+fy///2v+n5L+/+//v+z/r///n//1/1f9f2v+/1n//0n7//n//0n7//n/n7b/nxv/35b/v+P/n7b/n/f/j/b/b///P97v//29//8f+v5f///z//3/j///n//v//3/b///t/3+Yv///f//+b+P///f//+b+v/3///+/9v9//z+X/v9v/v+X/v8v/f9v/v8n/v8n/f9P+v/f/P/P+v/P+v/f/P/f+v9/8/9f+v9/9f8/9f+/+v+f/v9P/v/f/P/P+v9v/n/b/v+X/v+v+f+/9f//2v//6v//6v//6v//6v//6v9/8/+/Wf//2v//6v//6v9/9f+f/P/P+v/P+v/P+v/f/P/f+v/P+v/f/P9v/n+b/v8n/f9v/v8n/f9P+v9v/n+b/v82/f9v/v+b/v8v/f9v/n+T/n8yP/9k=";
    
    // ------------------------------ LOGIN SCREEN ------------------------------
    function LoginScreen() {
        const [email, setEmail] = useState('');
        const [password, setPassword] = useState('');
        const [error, setError] = useState('');
        const [message, setMessage] = useState('');
        const [view, setView] = useState('login'); // 'login', 'register', 'reset'
        const [loading, setLoading] = useState(false);

        const handleAuthAction = async (e) => {
            e.preventDefault();
            setLoading(true);
            setError('');
            setMessage('');
            try {
                if (view === 'register') {
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    await db.collection('users').doc(userCredential.user.uid).collection('profile').doc('main').set(initialState.perfil);
                } else {
                    await auth.signInWithEmailAndPassword(email, password);
                }
            } catch (err) {
                setError(err.message);
            } finally {
                setLoading(false);
            }
        };

        const handlePasswordReset = async (e) => {
            e.preventDefault();
            setLoading(true);
            setError('');
            setMessage('');
            try {
                await auth.sendPasswordResetEmail(email);
                setMessage('Se envió un correo para restablecer tu contraseña.');
            } catch (err) {
                setError(err.message);
            } finally {
                setLoading(false);
            }
        };

        return (
            <div className="min-h-screen bg-slate-100 flex flex-col justify-center items-center p-4">
                <div className="w-full max-w-sm mx-auto">
                    <div className="flex flex-col items-center mb-6">
                        <img src={logoCircularBase64} alt="Logo Circular" className="w-20 h-20 rounded-full mb-4"/>
                        <img src={logoCoachexBase64} alt="Coachex-Pro Logo" style={{ height: '32px' }}/>
                        <p className="text-slate-600 mt-1">Gestión de Profesores</p>
                    </div>
                    
                    <div className="bg-white rounded-2xl shadow-lg p-8">
                        {view === 'login' && (
                            <div>
                                <h2 className="text-2xl font-bold text-center text-slate-800 mb-6">Iniciar Sesión</h2>
                                <form onSubmit={handleAuthAction} className="space-y-4">
                                    <div>
                                        <label className="text-sm font-medium text-slate-600">Email</label>
                                        <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} className="w-full mt-1 border rounded-lg px-3 py-2" required />
                                    </div>
                                    <div>
                                        <label className="text-sm font-medium text-slate-600">Contraseña</label>
                                        <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="w-full mt-1 border rounded-lg px-3 py-2" required />
                                    </div>
                                    {error && <p className="text-sm text-red-600">{error}</p>}
                                    <button type="submit" disabled={loading} className="w-full bg-slate-900 text-white py-2 rounded-lg font-semibold hover:bg-slate-800 transition disabled:bg-slate-400">
                                        {loading ? 'Cargando...' : 'Ingresar'}
                                    </button>
                                </form>
                                <div className="text-center mt-4">
                                    <button onClick={() => setView('reset')} className="text-sm text-blue-600 hover:underline">¿Olvidaste tu contraseña?</button>
                                </div>
                                <div className="text-center mt-2">
                                    <button onClick={() => setView('register')} className="text-sm text-slate-600 hover:underline">¿No tenés cuenta? Registrate</button>
                                </div>
                            </div>
                        )}

                        {view === 'register' && (
                             <div>
                                <h2 className="text-2xl font-bold text-center text-slate-800 mb-6">Crear Cuenta</h2>
                                <form onSubmit={handleAuthAction} className="space-y-4">
                                    <div>
                                        <label className="text-sm font-medium text-slate-600">Email</label>
                                        <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} className="w-full mt-1 border rounded-lg px-3 py-2" required />
                                    </div>
                                    <div>
                                        <label className="text-sm font-medium text-slate-600">Contraseña</label>
                                        <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="w-full mt-1 border rounded-lg px-3 py-2" required />
                                    </div>
                                    {error && <p className="text-sm text-red-600">{error}</p>}
                                    <button type="submit" disabled={loading} className="w-full bg-slate-900 text-white py-2 rounded-lg font-semibold hover:bg-slate-800 transition disabled:bg-slate-400">
                                        {loading ? 'Cargando...' : 'Registrarse'}
                                    </button>
                                </form>
                                <div className="text-center mt-4">
                                     <button onClick={() => setView('login')} className="text-sm text-slate-600 hover:underline">¿Ya tenés cuenta? Ingresá</button>
                                </div>
                            </div>
                        )}
                        
                        {view === 'reset' && (
                             <div>
                                <h2 className="text-2xl font-bold text-center text-slate-800 mb-6">Restablecer Contraseña</h2>
                                <form onSubmit={handlePasswordReset} className="space-y-4">
                                    <div>
                                        <label className="text-sm font-medium text-slate-600">Email de tu cuenta</label>
                                        <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} className="w-full mt-1 border rounded-lg px-3 py-2" required />
                                    </div>
                                    {error && <p className="text-sm text-red-600">{error}</p>}
                                    {message && <p className="text-sm text-green-600">{message}</p>}
                                    <button type="submit" disabled={loading} className="w-full bg-slate-900 text-white py-2 rounded-lg font-semibold hover:bg-slate-800 transition disabled:bg-slate-400">
                                        {loading ? 'Enviando...' : 'Enviar correo'}
                                    </button>
                                </form>
                                <div className="text-center mt-4">
                                     <button onClick={() => setView('login')} className="text-sm text-slate-600 hover:underline">Volver a Iniciar Sesión</button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            </div>
        );
    }
    
    function MainApp({ user, onLogout }) {
      const [current, setCurrent] = useState("dashboard");
      const [state, setState] = useState({ alumnos: [], clases: [], pagos: [], gastos: [], perfil: {} });
      const [loading, setLoading] = useState(true);
      const [toast, setToast] = useState("");
      const [deletingInfo, setDeletingInfo] = useState({ id: null, type: null, collection: null });
      const [payingMixtoClase, setPayingMixtoClase] = useState(null);
      const [payingCuota, setPayingCuota] = useState({alumno: null, mes: null});
      const [goToClassForm, setGoToClassForm] = useState(false);

      useEffect(() => {
        if (!user) return;
        setLoading(true);
        const collections = ['alumnos', 'clases', 'pagos', 'gastos'];
        const unsubscribes = [];

        collections.forEach(collectionName => {
            const unsubscribe = db.collection('users').doc(user.uid).collection(collectionName).onSnapshot(snapshot => {
                const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                setState(prevState => ({ ...prevState, [collectionName]: data }));
            }, error => console.error(`Error fetching ${collectionName}: `, error));
            unsubscribes.push(unsubscribe);
        });

        const profileUnsubscribe = db.collection('users').doc(user.uid).collection('profile').doc('main').onSnapshot(doc => {
            if (doc.exists) {
                setState(prevState => ({ ...prevState, perfil: { ...initialState.perfil, ...doc.data()} }));
            } else {
                 setState(prevState => ({ ...prevState, perfil: initialState.perfil }));
            }
            setLoading(false);
        }, error => {
            console.error("Error fetching profile: ", error);
            setLoading(false);
        });
        unsubscribes.push(profileUnsubscribe);

        return () => unsubscribes.forEach(unsub => unsub());
      }, [user]);

      const getCollection = (collectionName) => db.collection('users').doc(user.uid).collection(collectionName);

      const alumnoCrud = {
        create: (data) => getCollection('alumnos').add(data).then(() => setToast("Alumno creado")),
        update: ({id, ...data}) => getCollection('alumnos').doc(id).update(data).then(() => setToast("Alumno actualizado")),
        delete: (id) => setDeletingInfo({ id, type: 'alumno', collection: 'alumnos' }),
      };
      const claseCrud = { 
        create: async (c) => { 
            const claseData = {...c};
            delete claseData.id;
            if (claseData.recurrente) {
                const batch = db.batch();
                const semanas = parseInt(claseData.mesesRecurrencia, 10) * 4;
                for(let i=0; i<semanas; i++) {
                    const nuevaFecha = addDays(new Date(claseData.fecha), i * 7);
                    const newClase = { ...claseData, fecha: formatDate(nuevaFecha), recurrente: false };
                    const docRef = getCollection('clases').doc();
                    batch.set(docRef, newClase);
                }
                await batch.commit();
                setToast("Clases recurrentes creadas");
            } else {
                await getCollection('clases').add(claseData);
                setToast("Clase creada");
            }
        }, 
        update: ({id, ...data}) => getCollection('clases').doc(id).update(data).then(() => setToast("Clase actualizada")),
        delete: (id) => setDeletingInfo({ id, type: 'clase', collection: 'clases' }),
        onPayMixto: (clase) => setPayingMixtoClase(clase)
      };
      const pagoCrud = { 
        createMixto: async (pagoData) => { 
          const batch = db.batch();
          if(pagoData.efectivo && parseFloat(pagoData.efectivo) > 0) {
            const docRef = getCollection('pagos').doc();
            batch.set(docRef, { claseId: payingMixtoClase.id, alumnoId: payingMixtoClase.alumnoIds[0], fecha: payingMixtoClase.fecha, metodo: 'Efectivo', monto: pagoData.efectivo });
          }
          if(pagoData.transferencia && parseFloat(pagoData.transferencia) > 0) {
            const docRef = getCollection('pagos').doc();
            batch.set(docRef, { claseId: payingMixtoClase.id, alumnoId: payingMixtoClase.alumnoIds[0], fecha: payingMixtoClase.fecha, metodo: 'Transferencia', monto: pagoData.transferencia });
          }
          await batch.commit();
          setToast("Pago registrado"); 
          setPayingMixtoClase(null);
        },
        createMensual: (pagoData) => { 
            const { alumno, mes } = payingCuota; 
            const fecha = new Date(); 
            fecha.setMonth(mes); 
            const newPago = { alumnoId: alumno.id, fecha: formatDate(fecha), concepto: `Cuota Mensual - ${MESES_NOMBRES[mes]}`, ...pagoData };
            getCollection('pagos').add(newPago).then(() => {
                setToast("Pago de cuota registrado"); 
                setPayingCuota({alumno: null, mes: null});
            });
        }
      };
      const gastoCrud = { 
        create: (g) => { const data = {...g}; delete data.id; getCollection('gastos').add(data).then(() => setToast("Gasto creado")) },
        update: ({id, ...data}) => getCollection('gastos').doc(id).update(data).then(() => setToast("Gasto actualizado")),
        delete: (id) => setDeletingInfo({ id, type: 'gasto', collection: 'gastos' }),
      };
      const perfilCrud = { 
        update: (p) => db.collection('users').doc(user.uid).collection('profile').doc('main').update(p).then(() => setToast("Perfil actualizado"))
      };
      
      const confirmDelete = async () => {
        const { id, type, collection } = deletingInfo;
        if (!id || !collection) return;
        await getCollection(collection).doc(id).delete();
        if(type === 'clase'){
            const pagosSnapshot = await getCollection('pagos').where('claseId', '==', id).get();
            const batch = db.batch();
            pagosSnapshot.forEach(doc => batch.delete(doc.ref));
            await batch.commit();
        }
        setToast(`${type.charAt(0).toUpperCase() + type.slice(1)} eliminado/a`);
        setDeletingInfo({ id: null, type: null, collection: null });
      };

      if (loading) {
        return <div className="min-h-screen flex items-center justify-center"><div className="loader"></div></div>;
      }
      
       return (
        <div className="min-h-screen bg-slate-50 font-sans">
          <Topbar current={current} setCurrent={setCurrent} onLogout={onLogout} />
          <main className="max-w-6xl mx-auto px-4 py-6 grid gap-4">
            {current === "dashboard" && <Dashboard state={state} goToNewClass={() => { setCurrent('clases'); setTimeout(() => document.querySelector('#nueva-clase-btn')?.click(), 50); }} />}
            {current === "alumnos" && <Alumnos alumnos={state.alumnos} onCreate={alumnoCrud.create} onUpdate={alumnoCrud.update} onDelete={alumnoCrud.delete} />}
            {current === "clases" && <Clases clases={state.clases} alumnos={state.alumnos} pagos={state.pagos} perfil={state.perfil} onCreate={claseCrud.create} onUpdate={claseCrud.update} onDelete={claseCrud.delete} onPayMixto={claseCrud.onPayMixto} />}
            {current === "pagos" && <Pagos pagos={state.pagos} alumnos={state.alumnos} clases={state.clases} perfil={state.perfil} onPayMensual={(alumno, mes) => setPayingCuota({alumno, mes})} />}
            {current === "gastos" && <Gastos gastos={state.gastos} onCreate={gastoCrud.create} onUpdate={gastoCrud.update} onDelete={gastoCrud.delete} />}
            {current === "reportes" && <Reportes pagos={state.pagos} gastos={state.gastos} alumnos={state.alumnos} clases={state.clases} />}
            {current === "perfil" && <Perfil perfil={state.perfil} onUpdate={perfilCrud.update} user={user} setToast={setToast} />}
          </main>
          <Toast msg={toast} onClose={() => setToast("")} />
          <Modal isOpen={!!deletingInfo.id} title={`Eliminar ${deletingInfo.type}`} onConfirm={confirmDelete} onCancel={() => setDeletingInfo({ id: null, type: null, collection: null })} >
            ¿Estás seguro? Esta acción no se puede deshacer.
          </Modal>
          <PagoMixtoModal isOpen={!!payingMixtoClase} clase={payingMixtoClase} onCancel={() => setPayingMixtoClase(null)} onSave={pagoCrud.createMixto} />
          <PagoMensualModal isOpen={!!payingCuota.alumno} alumno={payingCuota.alumno} mes={payingCuota.mes} onCancel={() => setPayingCuota({alumno: null, mes: null})} onSave={pagoCrud.createMensual} />
          <footer className="text-center text-xs text-slate-500 py-6">Coachex-Pro · Gestión de Profesores</footer>
        </div>
      );
    }
    
    // ------------------------------ APP WRAPPER WITH AUTH ------------------------------
    function AppGPadel() {
        const [user, setUser] = useState(null);
        const [loading, setLoading] = useState(true);

        useEffect(() => {
            const unsubscribe = auth.onAuthStateChanged(user => {
                setUser(user);
                setLoading(false);
            });
            return () => unsubscribe();
        }, []);

        if (loading) {
            return <div className="min-h-screen flex items-center justify-center"><div className="loader"></div></div>;
        }

        if (!user) {
            return <LoginScreen />;
        }

        return <MainApp user={user} onLogout={() => auth.signOut()} />;
    }

    function Perfil({ perfil, onUpdate, user, setToast }) {
      const [form, setForm] = useState(perfil);
      
      useEffect(() => {
        if(perfil) setForm(perfil);
      }, [perfil]);

      const handleChange = (e) => {
        const { name, value } = e.target;
        setForm(prev => ({ ...prev, [name]: value }));
      };

      const handlePrecioChange = (e) => {
        const { name, value } = e.target;
        setForm(prev => ({ ...prev, precios: { ...prev.precios, [name]: value } }));
      };
      const handlePrecioMensualChange = (e) => {
        const { name, value } = e.target;
        setForm(prev => ({ ...prev, preciosMensuales: { ...prev.preciosMensuales, [name]: value } }));
      };
      const handleSubmit = (e) => {
        e.preventDefault();
        onUpdate(form);
      };

      const handlePasswordReset = () => {
        if(user && user.email) {
            auth.sendPasswordResetEmail(user.email)
                .then(() => {
                    setToast("Email para restablecer contraseña enviado.");
                })
                .catch((error) => {
                    setToast(`Error: ${error.message}`);
                });
        }
      };

      if (!form || !form.precios || !form.preciosMensuales) {
        return <div className="min-h-screen flex items-center justify-center"><div className="loader"></div></div>;
      }

      return (
        <form onSubmit={handleSubmit}>
          <Card title="Perfil y Configuración">
            <div className="grid md:grid-cols-2 gap-6">
              <div>
                <h4 className="text-md font-semibold text-slate-700 mb-2">Datos Personales</h4>
                <div className="grid gap-3">
                  <div><label className="text-sm text-slate-600">Nombre del Profesor</label><input name="nombre" value={form.nombre || ''} onChange={handleChange} className="w-full border rounded-lg px-3 py-2" /></div>
                  <div><label className="text-sm text-slate-600">Apellido</label><input name="apellido" value={form.apellido || ''} onChange={handleChange} className="w-full border rounded-lg px-3 py-2" /></div>
                  <div><label className="text-sm text-slate-600">Teléfono</label><input name="telefono" value={form.telefono || ''} onChange={handleChange} className="w-full border rounded-lg px-3 py-2" /></div>
                </div>
              </div>
              <div>
                <h4 className="text-md font-semibold text-slate-700 mb-2">Cuenta</h4>
                <div className="grid gap-3">
                  <div>
                    <label className="text-sm text-slate-600">Email de la cuenta</label>
                    <p className="w-full bg-slate-100 rounded-lg px-3 py-2 text-slate-700">{user?.email}</p>
                  </div>
                  <div>
                    <button type="button" onClick={handlePasswordReset} className="w-full px-4 py-2 rounded-lg border text-sm bg-slate-100 hover:bg-slate-200">
                      Restablecer Contraseña
                    </button>
                  </div>
                </div>
              </div>
            </div>
             <div className="mt-6 border-t pt-6">
                <h4 className="text-md font-semibold text-slate-700 mb-2">Precios por Clase</h4>
                <div className="grid grid-cols-2 gap-3">
                  <div><label className="text-sm text-slate-600">Individual</label><input type="number" name="individual" value={form.precios.individual} onChange={handlePrecioChange} className="w-full border rounded-lg px-3 py-2" /></div>
                  <div><label className="text-sm text-slate-600">Dupla</label><input type="number" name="dupla" value={form.precios.dupla} onChange={handlePrecioChange} className="w-full border rounded-lg px-3 py-2" /></div>
                  <div><label className="text-sm text-slate-600">Trío</label><input type="number" name="trio" value={form.precios.trio} onChange={handlePrecioChange} className="w-full border rounded-lg px-3 py-2" /></div>
                  <div><label className="text-sm text-slate-600">Cuarteto</label><input type="number" name="cuarteto" value={form.precios.cuarteto} onChange={handlePrecioChange} className="w-full border rounded-lg px-3 py-2" /></div>
                  <div className="col-span-2"><label className="text-sm text-slate-600">Escuelita</label><input type="number" name="escuelita" value={form.precios.escuelita} onChange={handlePrecioChange} className="w-full border rounded-lg px-3 py-2" /></div>
                </div>
            </div>
            <div className="mt-6 border-t pt-6">
                <h4 className="text-md font-semibold text-slate-700 mb-2">Precios Mensuales</h4>
                <div className="grid md:grid-cols-2 gap-3">
                    {FRECUENCIAS_MENSUALES.map(f => (
                        <div key={f.value}><label className="text-sm text-slate-600">{f.label}</label><input type="number" name={f.value} value={form.preciosMensuales[f.value]} onChange={handlePrecioMensualChange} className="w-full border rounded-lg px-3 py-2" /></div>
                    ))}
                </div>
            </div>
            <div className="mt-6 border-t pt-6">
              <h4 className="text-md font-semibold text-slate-700 mb-2">Modalidad de Cobro Principal</h4>
              <select name="metodoCobro" value={form.metodoCobro} onChange={handleChange} className="w-full border rounded-lg px-3 py-2">
                <option value="porClase">Por Clase</option>
                <option value="mensual">Mensual</option>
              </select>
            </div>
            <div className="mt-6 border-t pt-6">
                <h4 className="text-md font-semibold text-slate-700 mb-2">Canchas / Ubicaciones</h4>
                <textarea name="canchas" value={form.canchas} onChange={handleChange} className="w-full border rounded-lg px-3 py-2" rows={4} placeholder="Una ubicación por línea..."></textarea>
            </div>
            <div className="mt-6 flex justify-end">
              <button type="submit" className="px-4 py-2 rounded-lg bg-emerald-600 text-white">Guardar Cambios</button>
            </div>
          </Card>
        </form>
      );
    }

    function PagoMixtoModal({ isOpen, clase, onCancel, onSave }) {
      const [form, setForm] = useState({ efectivo: "", transferencia: "" });
      useEffect(() => { 
        if (clase) { 
          setForm({ efectivo: clase.precio || "", transferencia: "" }); 
        }
      }, [clase]);
      
      if (!isOpen || !clase) return null;

      const handleSave = () => { 
        if (!form.efectivo && !form.transferencia) return alert("Ingresá al menos un monto.");
        onSave(form); 
      };

      return (
        <Modal isOpen={isOpen} title={`Registrar Pago: ${clase.nombresAlumnos}`} onCancel={onCancel} onConfirm={handleSave} confirmText="Guardar Pago">
          <div className="grid gap-4">
            <p>Clase del {clase.fecha} a las {clase.hora}. Precio total: ${clase.precio}</p>
            <div><label className="text-sm text-slate-600">Monto en Efectivo</label><input type="number" value={form.efectivo} onChange={(e) => setForm({...form, efectivo: e.target.value})} className="w-full border rounded-lg px-3 py-2" placeholder="0.00" /></div>
            <div><label className="text-sm text-slate-600">Monto por Transferencia</label><input type="number" value={form.transferencia} onChange={(e) => setForm({...form, transferencia: e.target.value})} className="w-full border rounded-lg px-3 py-2" placeholder="0.00" /></div>
          </div>
        </Modal>
      );
    }
    
    function PagoMensualModal({ isOpen, alumno, mes, onCancel, onSave }) {
      const [form, setForm] = useState({ monto: "", metodo: "Efectivo" });
      useEffect(() => {
        if (alumno) {
          const restante = alumno.cuota - alumno.totalPagado;
          setForm({ monto: restante > 0 ? restante.toFixed(2) : "", metodo: "Efectivo" });
        }
      }, [alumno]);
      if (!isOpen || !alumno) return null;

      const handleSave = () => { onSave({ ...form, monto: form.monto || "0" }); };
      return (
        <Modal isOpen={isOpen} title={`Pago Cuota: ${alumno.nombre}`} onCancel={onCancel} onConfirm={handleSave} confirmText="Guardar Pago">
          <div className="grid gap-4">
            <p>Cuota de {MESES_NOMBRES[mes]} por ${alumno.cuota.toFixed(2)}. Pagado: ${alumno.totalPagado.toFixed(2)}.</p>
            <div><label className="text-sm text-slate-600">Monto a Pagar</label><input type="number" value={form.monto} onChange={(e) => setForm({...form, monto: e.target.value})} className="w-full border rounded-lg px-3 py-2" placeholder="0.00" /></div>
            <div><label className="text-sm text-slate-600">Método de Pago</label><select value={form.metodo} onChange={(e) => setForm({...form, metodo: e.target.value})} className="w-full border rounded-lg px-3 py-2">{METODOS_PAGO.filter(m => m !== 'Pendiente').map(m => <option key={m}>{m}</option>)}</select></div>
          </div>
        </Modal>
      );
    }
    
    ReactDOM.render(<AppGPadel />, document.getElementById('root'));
  </script>

</body>
</html>

